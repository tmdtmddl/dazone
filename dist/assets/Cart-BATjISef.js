import{G as k,j as o,r as h,t as _,L as P,l as E,m as A,n as F}from"./index-Dp55R4ab.js";import{p as O}from"./pricfy-QJrL3HHz.js";import{b as S,c as I}from"./index-BQZluWPf.js";import{u as q}from"./orderquery-CfNuMZaa.js";import{v as z}from"./v4-C6aID195.js";function D(e){return k({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"},child:[]}]})(e)}function H(e){return k({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2zm-9 14-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"},child:[]}]})(e)}const K=({state:e,onClick:t})=>o.jsx("button",{type:"button",onClick:t,className:"text-theme hover:shadow-none",children:e?o.jsx(H,{}):o.jsx(D,{})}),Q=({onChange:e,quan:t,isPending:r})=>{const a="w-8 h-8 hover:shadow-none hover:bg-white dark:hover:bg-darkBg",n=h.useMemo(()=>t,[]);return o.jsxs("div",{className:"flex",children:[o.jsx("button",{className:_(a,"hover:text-warning"),type:"button",onClick:()=>e(t-1),children:o.jsx(S,{})}),o.jsxs("button",{className:_(a,"relative"),type:"button",onClick:()=>e(n),children:[r&&o.jsx(P,{noMessage:!0,className:"absolute h-full "}),t]}),o.jsx("button",{className:_(a,"hover:text-theme"),type:"button",onClick:()=>e(t+1),children:o.jsx(I,{})})]})},W=e=>{const{name:t,desc:r,imgs:a,price:n,quan:u,isOnBasket:d,createdAt:l}=e,{updateAnItem:i,removeAnItem:f}=E(),[s,c]=h.useTransition(),[g,N]=h.useTransition();return o.jsxs("div",{className:"flex p-2.5 border-border border rounded dark:border-darkBorder relative",children:[s&&o.jsx(P,{className:"absolute h-full bg-white/80"}),o.jsx(K,{state:d,onClick:()=>c(async()=>{const{success:p,message:m}=await i({...e,isOnBasket:!d});if(!p)return alert(m)})}),o.jsxs("div",{className:"flex-1 flex gap-x-2.5",children:[o.jsx("div",{className:"overflow-hidden aspect-square w-30 sm:w-40",children:o.jsx("img",{src:a[0],alt:t,className:"aspect-square object-cover hover:scale-105 transition"})}),o.jsxs("div",{className:"flex flex-col gap-y-1 flex-1 w-2",children:[o.jsx("p",{className:"font-bold truncate",children:t}),o.jsx("p",{className:"font-light line-clamp-4 leading-5",children:r}),o.jsxs("div",{className:"flex gap-x-2.5",children:[o.jsx(Q,{quan:u,onChange:p=>{if(p===0)return;const m={...e,quan:p};N(async()=>{const{success:C,message:M}=await i({...m});if(!C)return alert(M)})},isPending:g}),o.jsx("button",{className:"h-8 text-warning hover:shadow-none hover:bg-white dark:hover:bg-darkBg",onClick:()=>c(async()=>{const{success:p,message:m}=await f(e);if(!p)return alert(m);alert("장바구니에서 삭제되었습니다.")}),children:"삭제"})]}),o.jsxs("p",{className:"text-gray-400",children:["담은날짜:",l]})]}),o.jsxs("p",{children:["₩",O(n)]})]})]})};var G="https://js.tosspayments.com/v2/standard";function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},y(e)}function x(e,t){return x=Object.setPrototypeOf||function(a,n){return a.__proto__=n,a},x(e,t)}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function w(e,t,r){return R()?w=Reflect.construct:w=function(n,u,d){var l=[null];l.push.apply(l,u);var i=Function.bind.apply(n,l),f=new i;return d&&x(f,d.prototype),f},w.apply(null,arguments)}function V(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function j(e){var t=typeof Map=="function"?new Map:void 0;return j=function(a){if(a===null||!V(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(a))return t.get(a);t.set(a,n)}function n(){return w(a,arguments,y(this).constructor)}return n.prototype=Object.create(a.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),x(n,a)},j(e)}function J(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function U(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return J(e)}function L(e){var t=R();return function(){var a=y(e),n;if(t){var u=y(this).constructor;n=Reflect.construct(a,arguments,u)}else n=a.apply(this,arguments);return U(this,n)}}var v=null;function $(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(v!=null)return v;var a=new Promise(function(n,u){try{var d=function(){b(t)!=null?n(b(t)):u(new X(t))},l=function(){u(new Y(e))};if(typeof window>"u"||typeof document>"u")return n(null);if(b(t)!=null)return n(b(t));var i=document.querySelector('script[src="'.concat(e,'"]'));if(i!=null){var f;i.removeEventListener("load",d),i.removeEventListener("error",l),(f=i.parentElement)===null||f===void 0||f.removeChild(i)}var s=document.createElement("script");s.src=e,s.addEventListener("load",d),s.addEventListener("error",l),r.priority!=null&&(s.fetchPriority=r.priority),document.head.appendChild(s)}catch(c){u(c);return}});return v=a.catch(function(n){return v=null,Promise.reject(n)}),v}function b(e){return window[e]}var X=function(e){B(r,e);var t=L(r);function r(a){var n;return T(this,r),n=t.call(this,"[TossPayments SDK] ".concat(a," is not available")),n.name="NamespaceNotAvailableError",n}return r}(j(Error)),Y=function(e){B(r,e);var t=L(r);function r(a){var n;return T(this,r),n=t.call(this,"[TossPayments SDK] Failed to load script: [".concat(a,"]")),n.name="ScriptLoadFailedError",n}return r}(j(Error));function Z(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=t.src,a=r===void 0?G:r;return typeof window>"u"?Promise.resolve({}):$(a,"TossPayments").then(function(n){return n(e)})}const ae=e=>{const{cart:t}=E(),[r,a]=h.useState([]);h.useEffect(()=>{const s=[];t.map(c=>c.isOnBasket&&s.push(c)),a(s)},[t]);const n=h.useMemo(()=>r.reduce((s,c)=>s+c.quan*Number(c.price),0),[r]),[u,d]=h.useTransition(),l=A(e==null?void 0:e.uid),i=q(e==null?void 0:e.uid),f=h.useCallback(()=>{d(async()=>{try{if(!e)return alert("로그인 해주세요.");const s=await Z("test_ck_D5GePWvyJnrK0W0k6q8gLzN97Eoq"),c=z(),g={amount:{currency:"KRW",value:n},method:"CARD",orderId:c,orderName:r.length>1?`${r[0].name} 등 ${r.length}개의 상품`:r[0].name};await s.payment({customerKey:e.uid}).requestPayment(g),await i.updateFn("CREATE",{...g,createdAt:F(),items:r});for(const N of r)await l.updateFn("DELETE",N);alert("결제가 완료되었습니다.")}catch(s){return alert(s.message)}})},[r,n,e,l,i]);return o.jsxs("div",{className:"flex flex-col gap-y-2.5 p-5",children:[u&&o.jsx(P,{message:"결제중입니다...",className:"top-0"}),o.jsx("h1",{className:"font-black text-2xl",children:"장바구니"}),o.jsx("ul",{className:"flex flex-col gap-y-2.5",children:t.map(s=>o.jsx("li",{className:"hover:bg-bg dark:hover:bg-darkBorder",children:o.jsx(W,{...s})},s.id))}),r.length>0&&o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"text-right text-xl my-5",children:["합계 (",r.reduce((s,c)=>s+c.quan,0),"개의 상품):",o.jsxs("b",{children:[" ",O(n),"원"]})]}),o.jsx("button",{onClick:f,className:"btn",children:"결제하기"})]})]})};export{ae as default};
