import{j as e,r as t,s as W,b as K,g as G,L as T,c as J,e as q,d as V,F as X,f as A,u as Y,h as U,t as Z}from"./index-Dp55R4ab.js";import{T as w}from"./input-BpfK-2in.js";import{F as R}from"./Form-BNsRBQ73.js";import{A as _,a as ee}from"./index-BQZluWPf.js";import{u as z}from"./prouct.query-DFPNwANg.js";import{v as F}from"./v4-C6aID195.js";import{P as se}from"./ProductItem-1C3bp4ew.js";import"./pricfy-QJrL3HHz.js";const I=({file:s,onChangeFiles:a,ref:n,onDelete:r})=>e.jsxs("div",{className:"relative w-25 h-25 border rounded overflow-hidden",children:[s?e.jsx("button",{className:"relative z-10 w-full h-full opacity-0 hover:opacity-80 bg-gray-900 text-white text-2xl",type:"button",onClick:r,children:e.jsx(_,{})}):e.jsx("input",{type:"file",className:"relative z-10 w-full h-full bg-red-500 opacity-0",onChange:l=>{a&&l.target.files&&a(l.target.files)},multiple:!0,ref:n}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full text-2xl flex justify-center items-center",children:s?e.jsx("img",{src:URL.createObjectURL(s),alt:s.name,className:"w-full h-full object-cover"}):e.jsx(ee,{})})]}),M={name:"상품1",desc:"상품 내용은 이것입니다.",id:"",imgs:[],price:"500",quan:1},te=s=>{const[a,n]=t.useState(M),{desc:r,name:l,price:u,quan:d}=a,x=t.useCallback((c,f)=>n(k=>({...k,[c]:f})),[]),b=t.useRef(null),p=t.useRef(null),m=t.useRef(null),j=t.useRef(null),g=t.useRef(null),[o,i]=t.useState([]),y=t.useCallback(c=>{for(const f of c){if(o.find(N=>N.name===f.name&&N.size===f.size&&N.type===f.type))return alert("이미 추가된 파일입니다.");i(N=>[...N,f])}},[o]),[C,S]=t.useTransition(),{addProduct:P}=z(s),h=t.useCallback(()=>{var f,k,N,B;if(l.length===0)return alert("상품 이름을 입력해주세요."),(f=b.current)==null?void 0:f.focus();if(r.length===0)return alert("상품을 설명해주세요."),(k=p.current)==null?void 0:k.focus();if(u.length===0)return alert("상품 가격을 입력해주세요."),(N=m.current)==null?void 0:N.focus();if(!/^[0-9]+$/.test(u))return alert("숫자만 입력해주세요."),(B=m.current)==null?void 0:B.focus();if(o.length===0)return alert("최소 1개의 상품 이미지를 등록해주세요."),setTimeout(()=>{var v;(v=g.current)==null||v.click()},300);S(async()=>{try{const v=[];for(const H of o){const E=W.ref(`${s.uid}/products/${F()}`);await K(E,H);const Q=await G(E);v.push(Q)}const D=F(),L={...a,id:D,imgs:v,uid:s.uid},{message:O,success:$}=await P(L);if(!$)return alert(O);alert("상품이 등록되었습니다."),n(M),i([])}catch(v){return alert(v.message)}})},[l,r,u,o,s,a,P]);return e.jsxs(R,{className:"relative",onSubmit:h,children:[C&&e.jsx(T,{className:"absolute h-full",message:"상품 등록중..."}),e.jsx(w,{value:l,id:"name",onChangeText:c=>x("name",c),ref:b,label:"상품이름",placeholder:"박보검이 사인한 책"}),e.jsxs("div",{className:"ti-con",children:[e.jsx("label",{htmlFor:"desc",className:"ti-l",children:"상품설명"}),e.jsx("textarea",{id:"desc",value:r,onChange:c=>x("desc",c.target.value),className:"ti-i h-25 resize-none [&::-webkit-scrollbar]:w-2.5 [&::-webkit-scrollbar-track]:bg-b dark:[&::-webkit-scrollbar-track]:bg-darkBorder [&::-webkit-scrollbar-thumb]:bg-theme hover:[&::-webkit-scrollbar-thumb]:cursor-pointer [&::-webkit-scrollbar-thumb]:rounded py-2.5",ref:p,placeholder:"여기에 상품설명을 입력하세요"})]}),e.jsx(w,{value:u,id:"price",onChangeText:c=>x("price",c),ref:m,label:"상품가격",placeholder:"10,000원",type:"number",props:{min:0}}),e.jsx(w,{value:d,id:"quan",onChangeText:c=>x("quan",c),ref:j,label:"상품재고",type:"number",props:{min:1}}),e.jsxs("div",{className:"ti-con",children:[e.jsx("label",{htmlFor:"img",className:"ti-l",children:"상품이미지"}),e.jsxs("ul",{className:"flex flex-wrap gap-2.5",children:[o.map(c=>e.jsx("li",{children:e.jsx(I,{file:c,onDelete:()=>i(f=>f.filter(k=>k.name!==c.name))})},c.name)),e.jsx("li",{children:e.jsx(I,{ref:g,onChangeFiles:y})})]})]}),e.jsx("button",{className:"btn mt-5",children:"상품등록"})]})},ae=()=>{const s=J(),{signin:a}=q(),[n,r]=t.useState(""),[l,u]=t.useState(""),d=t.useRef(null),x=t.useRef(null),b=t.useCallback(async()=>{var j,g,o,i;if(((j=d.current)==null?void 0:j.message)==="code 0")return alert("이메일을 입력해주세요."),(g=d.current)==null?void 0:g.focus();if(((o=x.current)==null?void 0:o.message)==="code 0")return alert("비밀번호를 입력해주세요."),(i=x.current)==null?void 0:i.focus();const{message:p,success:m}=await a(n,l);if(!m&&p)return alert(p);console.log("user login succeeded"),alert("환영합니다!"),s("/myAccount")},[n,l,a,s]);return e.jsxs("div",{className:"max-w-100 mx-auto mt-5 flex flex-col",children:[e.jsxs(R,{onSubmit:b,className:"border rounded dark:border-darkBorder border-border p-5",children:[e.jsx(w,{id:"email",label:"이메일",onChangeText:r,ref:d,value:n,placeholder:"email@email.com",type:"email"}),e.jsx(w,{id:"password",label:"비밀번호",onChangeText:u,ref:x,value:l,placeholder:"* * * * * * * *",type:"password"}),e.jsx("button",{className:"btn",children:"Submit"})]}),e.jsxs("div",{className:"my-5 relative flex justify-center",children:[e.jsx("p",{className:"bg-white px-2.5 text-xs dark:bg-darkBg",children:"또는 회원가입"}),e.jsx("span",{className:"absolute -z-1 block w-full h-[1px] bg-darkBg top-[50%] dark:bg-darkColor"})]}),e.jsx("button",{className:"btn border",onClick:()=>s("/signup"),children:"회원가입"})]})},re=s=>{const[a,n]=t.useState(s.name),[r,l]=t.useState((s==null?void 0:s.address)??""),[u,d]=t.useState(!1),[x,b]=t.useState(!1),p=t.useRef(null),m=t.useRef(null),j=t.useMemo(()=>!(a.length===0||a===s.name),[s.name,a]),g=t.useMemo(()=>!(r.length===0||s.address===r),[s.address,r]),[o,i]=t.useTransition(),y=t.useMemo(()=>V.collection(X.USERS).doc(s==null?void 0:s.uid),[s]),{updateUser:C}=q(),S=t.useCallback(()=>i(async()=>{try{if(a.length===0)return alert("이름을 입력해주세요.");if(!j)return alert("변경사항이 없습니다.");await y.update({name:a}),C("name",a),alert("이름이 수정되었습니다."),d(!1)}catch(h){alert(h.message)}}),[y,a,j,C]),P=t.useCallback(()=>i(async()=>{var h,c;if(r.length===0)return alert("아무것도 입력되지 않았습니다."),(h=m.current)==null?void 0:h.focus();if(!g)return alert("변경사항이 없습니다."),(c=m.current)==null?void 0:c.focus();try{await y.update({address:r}),C("address",r),alert("주소가 변경되었습니다."),b(!1)}catch(f){return alert(f.message)}}),[y,r,g,C]);return e.jsxs("div",{className:"h-full relative",children:[o&&e.jsx(T,{className:"absolute h-full"}),u?e.jsxs(R,{className:"flex-row gap-x-2.5 items-end max-w-100",onSubmit:S,children:[e.jsx("div",{className:"flex-1",children:e.jsx(w,{id:"name",label:"이름",onChangeText:n,ref:p,value:a,placeholder:s.name})}),e.jsx("button",{type:"button",className:"bg-bg dark:bg-darkBorder",onClick:()=>{n(s.name),d(!1)},children:"취소"}),j&&e.jsx("button",{className:"btn rounded-sm",children:"저장"})]}):e.jsxs("button",{className:"font-black text-2xl hover:shadow-none hover:bg-bg dark:hover:bg-darkBorder",onClick:()=>{var h;d(!0),(h=p.current)==null||h.focus()},children:["Hi, ",s.name]}),e.jsx("p",{className:"text-xl font-light px-2.5",children:s.email}),e.jsx("button",{className:"text-sm text-gray-500 hover:shadow-none hover:bg-bg dark:hover:bg-darkBorder",onClick:()=>alert("uid copied"),children:s.uid}),x?e.jsxs(R,{className:"max-w-100",onSubmit:P,children:[e.jsx(w,{ref:m,id:"address",label:"주소",onChangeText:l,value:r,placeholder:"내가 살던 고향은"}),e.jsxs("div",{className:"flex gap-x-2.5 justify-end",children:[e.jsx("button",{type:"button",className:"bg-bg dark:bg-darkBorder",onClick:()=>{l((s==null?void 0:s.address)??""),b(!1)},children:"취소"}),g&&e.jsx("button",{className:"btn rounded-sm",children:"저장"})]})]}):e.jsx("button",{className:"bg-bg dark:bg-darkBorder",onClick:()=>{b(!0),setTimeout(()=>{var h;(h=m.current)==null||h.focus()},100)},children:(s==null?void 0:s.address)??"주소를 입력해주세요."})]})},ne=s=>{const[a,n]=t.useTransition(),[r,l]=t.useState(""),[u,d]=t.useState(""),x=t.useRef(null),b=t.useRef(null),[p,m]=t.useState(!1),j=t.useCallback(()=>n(async()=>{try{if(!s)return alert("로그인하지 않았습니다.");const o=await A.signInWithEmailAndPassword(s.email,r);if(!o.user||!o.user.uid)return alert("비밀번호가 일치하지 않습니다.");alert("새로운 비밀번호를 입력해주세요."),m(!0),setTimeout(()=>{var i;(i=b.current)==null||i.focus()},100)}catch(o){return alert(o.message)}}),[r,s]),g=t.useCallback(()=>n(async()=>{var o;try{if(!s)return alert("로그인하지 않았습니다.");const i=await A.signInWithEmailAndPassword(s.email,r);if(!i.user||!i.user.uid)return alert("비밀번호가 일치하지 않습니다.");await((o=A.currentUser)==null?void 0:o.updatePassword(u)),alert("비밀번호가 변경되었습니다."),m(!1),l(""),d("")}catch(i){alert(i.message)}}),[s,u,r]);return e.jsxs("div",{className:"h-full relative",children:[a&&e.jsx(T,{className:"absolute h-full"}),p?e.jsxs(R,{className:"max-w-100",onSubmit:g,children:[e.jsx(w,{type:"password",value:u,id:"newPw",label:"새로운 비밀번호",onChangeText:d,ref:b,placeholder:"* * * * * * * *"}),e.jsx("button",{className:"btn rounded-sm",children:"비밀번호 변경"})]}):e.jsxs(R,{className:"max-w-100",onSubmit:j,children:[e.jsx(w,{type:"password",value:r,id:"pw",label:"현재 비밀번호",onChangeText:l,ref:x,placeholder:"* * * * * * * * *"}),e.jsx("button",{className:"btn rounded-sm",children:"비밀번호 확인"})]})]})},le=s=>{const{queryFn:a,queryKey:n}=z(s),{data:r,error:l,isPending:u}=Y({queryFn:a,queryKey:n});return u?e.jsx(T,{}):l||!r?e.jsxs("h1",{children:["Error: ",l.message]}):e.jsx("div",{children:e.jsx("ul",{className:"grid grid-cols-2 gap-2.5",children:r.map(d=>e.jsx("li",{children:e.jsx(se,{...d})},d.id))})})},oe=["기본정보","비밀번호변경","상품등록","나의상품"],ce=()=>{const{changeTarget:s,target:a}=U();return e.jsx("aside",{className:"border-r border-border dark:border-darkBorder",children:e.jsx("ul",{className:"",children:oe.map(n=>e.jsx("li",{children:e.jsx("button",{className:Z("w-full items-start hover:shadow-none",a===n&&"text-theme"),onClick:()=>s(n),children:n})},n))})})},ge=({user:s})=>{const{target:a}=U();return s?e.jsxs("div",{className:"flex max-w-300 mx-auto px-2.5",style:{minHeight:"calc(100vh - 61px)"},children:[e.jsx(ce,{}),e.jsx("main",{className:"m-5 flex-1",children:{기본정보:e.jsx(re,{...s}),비밀번호변경:e.jsx(ne,{...s}),상품등록:e.jsx(te,{...s}),나의상품:e.jsx(le,{...s})}[a]})]}):e.jsx(ae,{})};export{ge as default};
